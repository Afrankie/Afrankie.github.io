---
title: "MIT6s081 虚拟内存"
date: 2022-02-23T17:34:34+08:00
---


## 先从几个有趣的问题开始
- 为什么需要虚拟内存，有什么好处？

- xv6中给对象分配内存的过程是怎么样的呢？

扩展进程大小，用于存储该变量。
给每一段虚拟内存分配物理内存，具体操作是将虚拟内存映射到被分配的物理内存地址。

补充知识:
xv6以页(4096B)为分配内存的最小单位。

- 用户态可用的内存最大为多少？
位于KERNBASE(0x80000000)到PYTHSTOP之间的物理内存。

- 为什么把内存地址分为三级索引，将内存地址的9位作为每一级索引的下标？
2^(9\*3) = PYTHSTOP - KERNBASE = (128 * 1024 * 1024) = 134217728


- 最大的虚拟内存地址是多少？
9+9+9+12=39，也就是2^39次方?


- 为什么需要自己写虚拟内存到物理内存的寻址？
我们需要对它进行编程，例如内核态中虚拟内存和物理内存的直接映射。


- 直接映射的好处？
trap中断处理那一章节可以学习到


## xv6关于虚拟内存的代码
### walk
### walkaddr
### mappages
### pte2pa
### pa2pte

## 基于虚拟内存的黑科技
### lazy allocation
### fork copy on write